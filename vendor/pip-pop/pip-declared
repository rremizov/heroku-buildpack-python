#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""Usage:
  pip-declared <reqfile>

Options:
  -h --help     Show this screen.
"""
import os
from docopt import docopt
from pip.req import parse_requirements


class Requirements(object):
    def __init__(self, reqfile=None):
        super(Requirements, self).__init__()
        self.path = reqfile
        self.requirements = []

        if reqfile:
            self.load(reqfile)

    def __repr__(self):
        return '<Requirements \'{}\'>'.format(self.path)

    def load(self, reqfile):

        if not os.path.exists(reqfile):
            raise ValueError('The given requirements file does not exist.')

        for requirement in parse_requirements(reqfile):
            self.requirements.append(requirement)


def declared(reqfile):
    try:
        r = Requirements(reqfile)
    except ValueError:
        print('There was a problem loading the given requirement file.')

        exit(os.EX_NOINPUT)

    for requirement in r.requirements:
        if requirement.url is not None:
            print('{}{}'.format('-e ' if requirement.editable else '', requirement.url))

        else:
            print('{}{}{}'.format(requirement.name, requirement.req.specs[0][0], requirement.req.specs[0][1]))


def main():
    args = docopt(__doc__, version='pip-grep')
    kwargs = {'reqfile': args['<reqfile>']}

    declared(**kwargs)


if __name__ == '__main__':
    main()

